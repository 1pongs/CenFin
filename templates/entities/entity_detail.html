{% extends "base.html" %}
{% load humanize acquisition_tags crispy_forms_tags currency_tags %}

{% block extra_css %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
{% endblock %}

{% block content %}
<a href="#" onclick="history.back();return false;" class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center gap-1 mb-3">
  <i class="bi bi-arrow-left"></i> Back
</a>
<div class="d-flex justify-content-between align-items-center mt-3">
  <h2 class="mb-0">{{ entity.entity_name }}</h2>
  <div>
    {% if not entity.is_account_entity and not entity.is_system_default %}
    <a href="{% url 'entities:edit' entity.pk %}?next={{ request.path }}" class="btn btn-sm btn-outline-primary me-2">Edit</a>
    <a href="{% url 'entities:delete' entity.pk %}" class="btn btn-sm btn-danger">Delete</a>
    {% endif %}
  </div>
</div>

<div class="d-flex justify-content-end mt-3">
  <a href="{% url 'acquisitions:acquisition-create' %}?entity={{ entity.pk }}" class="btn btn-primary btn-sm">
    <i class="bi bi-plus-lg me-1"></i>Add Acquisition
  </a>
</div>

<h4 class="mt-4">Acquisitions</h4>
<div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xxl-4 g-3 mb-4">
  {% for acq in acquisitions %}
    {% render_acquisition_card acq %}
  {% empty %}
    <p class="text-center">No acquisitions for this entity.</p>
  {% endfor %}
</div>

<h4 class="mt-4">Accounts</h4>
<table class="table table-bordered mt-2">
  <thead>
    <tr><th>Account</th><th class="text-end">Balance</th></tr>
  </thead>
  <tbody>
  {% for a in accounts %}
    <tr>
      <td>{{ a.name }}</td>
      <td class="text-end">
        {% display a.balance a.currency.code as disp_bal %}
        <span class="amount-display" data-prefix="{{ active_currency_symbol }}" data-decimals="2">
          {{ disp_bal|floatformat:2|intcomma }}
        </span>
      </td>
    </tr>
  {% empty %}
    <tr><td colspan="2" class="text-center">No accounts yet.</td></tr>
  {% endfor %}
  {% if accounts %}
    <tr class="fw-bold">
      <td>Total</td>
      <td class="text-end">
        {% display total_balance base_currency.code as disp_total %}
        <span class="amount-display" data-prefix="{{ active_currency_symbol }}" data-decimals="2">
          {{ disp_total|floatformat:2|intcomma }}
        </span>
      </td>
    </tr>
  {% endif %}
  </tbody>
</table>

{% endblock %}