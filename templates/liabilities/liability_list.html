{% extends 'liabilities/base.html' %}
{% load humanize static %}

{% block extra_css %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
{% endblock %}

{% block liabilities_content %}
<div class="row">
  <div class="col-lg-8 mb-4">
    {% if tab == 'loans' %}
      {% for loan in loans %}
        <div class="card cat-loan mb-3 p-3">
          <div class="d-flex justify-content-between">
            <div>
              <strong>{{ loan.lender.name }}</strong><br>
              <small>{{ loan.principal_amount|floatformat:2|intcomma }}</small>
            </div>
            <div class="text-end">
              <a href="#" class="btn btn-sm btn-primary">Record Payment</a>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="card text-center p-5">
          <i class="bi bi-wallet2 fs-1 mb-3 text-muted"></i>
          <p class="mb-0">No loans.</p>
     {% endfor %}
    {% else %}
      {% for card in credit_cards %}
        <div class="card cat-credit mb-3 p-3">
          <div class="d-flex justify-content-between">
            <div>
              <strong>{{ card.card_name }}</strong><br>
              <small>{{ card.issuer.name }}</small>
            </div>
            <div class="text-end">
              <a href="#" class="btn btn-sm btn-primary">Pay</a>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="card text-center p-5">
          <i class="bi bi-credit-card fs-1 mb-3 text-muted"></i>
          <p class="mb-0">No credit cards.</p>
        </div>
      {% endfor %}
    {% endif %}
  </div>
  <aside class="col-lg-4">
    <div class="p-3 sidebar rounded">
      <button type="button" class="btn btn-success w-100 mb-3" data-bs-toggle="modal" data-bs-target="#addLiabilityModal">
        <i class="bi bi-plus-lg me-1"></i>Add
      </button>
      {% include 'liabilities/_toolbar.html' %}
    </div>
  </aside>
</div>

<div class="modal fade" id="addLiabilityModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Liability</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-center">
        <p class="mb-3">Choose what you'd like to add:</p>
        <div class="d-flex justify-content-around">
          <a href="{% url 'liabilities:credit-create' %}" class="btn btn-outline-primary">
            Credit Card
          </a>
          <a href="{% url 'liabilities:loan-create' %}" class="btn btn-outline-primary">
            Loan
          </a>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('filter-form');
    if(form){
      form.querySelectorAll('select,input').forEach(el => {
        el.addEventListener('change', () => form.submit());
      });
    }
  });
</script>
{% endblock %}